<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EventScape — Dashboard</title>
  <link rel="stylesheet" href="globals.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="event-dashboard" id="dashboard-root">
    <!-- Base white sections -->
    <img class="dashboard-left-white" src="dashboard-left-white-square.svg" alt="" aria-hidden="true" />
    <img class="dashboard-main-white" src="dashboard-main-white-square.svg" alt="" aria-hidden="true" />
    <img class="dashboard-stats" src="dashboard-stats-square.svg" alt="" aria-hidden="true" />
    <div class="dashboard" id="dashboard-main">
      <div class="dashboard" id="dashboard-main">
        <% var _panel=(typeof panel !=='undefined' ) ? panel.trim() : 'profile' ; var _events=(typeof events
          !=='undefined' && Array.isArray(events)) ? events : []; var hasEvents=_events.length> 0;

          var _announcements = (typeof announcements !== 'undefined' && Array.isArray(announcements)) ? announcements : [];
          var _invitations = (typeof invitations !== 'undefined' && Array.isArray(invitations)) ? invitations : [];
          var _rsvpd = (typeof rsvpd !== 'undefined' && Array.isArray(rsvpd)) ? rsvpd : [];

          var hasAnnouncements = _announcements.length > 0;
          var hasInvitations = _invitations.length > 0;
          var hasRsvpd = _rsvpd.length > 0;
        %>
          
          <% if (_panel==='events' ) { %>
            <section class="events-panel">
              <h2>Upcoming Events</h2>

              <% if (hasEvents) { %>
                <table class="events-table">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Location</th>
                      <th>Start Time</th>
                      <th>End Time</th>
                      <th>Capacity</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% _events.forEach(function(e){ %>
                      <tr>
                        <td>
                          <%= e.title %>
                        </td>
                        <td>
                          <%= e.location || '—' %>
                        </td>
                        <td>
                          <%= new Date(e.start_time).toLocaleString() %>
                        </td>
                        <td>
                          <%= e.end_time ? new Date(e.end_time).toLocaleString() : '—' %>
                        </td>
                        <td>
                          <%= (e.capacity===null || e.capacity===undefined) ? '—' : e.capacity %>
                        </td>
                      </tr>
                      <% }); %>
                  </tbody>
                </table>
                <% } else { %>
                  <p class="no-events-msg">No upcoming events.</p>
                  <% } %>
            </section>

            <% } else if (_panel==='profile' ) { %>
              <section class="profile-panel">
                <h2>Profile Settings</h2>

                <div class="profile-row">
                  <label>Display name</label>
                  <div class="readonly-value">
                    <%= displayName %>
                  </div>
                </div>

                <div class="profile-row">
                  <label>Email</label>
                  <div class="readonly-value">
                    <%= email %>
                  </div>
                </div>

                <form id="notifForm" class="profile-row" method="POST" action="/profile/notification">
                  <label for="notification_setting">Notifications</label>
                  <select id="notification_setting" name="notification_setting"
                    onchange="document.getElementById('notifForm').submit()">
                    <option value="none" <%=notification_setting==='none' ? 'selected' : '' %>>None</option>
                    <option value="email" <%=notification_setting==='email' ? 'selected' : '' %>>Email</option>
                    <option value="in_app" <%=notification_setting==='in_app' ? 'selected' : '' %>>In-app</option>
                    <option value="all" <%=notification_setting==='all' ? 'selected' : '' %>>All</option>
                  </select>
                </form>
                <% if (saved) { %>
                  <div class="profile-saved">Settings saved ✔</div>
                  <% } %>
              </section>

              <% } else if (_panel==='inbox' ) { %>
                <section class="events-panel">
                  <h2>Announcements</h2>
                  <% if (hasAnnouncements) { %>
                    <table class="events-table">
                      <thead>
                        <tr>
                          <th>Title</th>
                          <th>Event</th>
                          <th>Posted</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% _announcements.forEach(function(a){ %>
                          <tr>
                            <td>
                              <%= a.announcement_title %>
                            </td>
                            <td>
                              <%= a.event_title || '—' %>
                            </td>
                            <td>
                              <%= new Date(a.announcement_created_at).toLocaleString() %>
                            </td>
                          </tr>
                          <% }) %>
                      </tbody>
                    </table>
                    <% } else { %>
                      <p class="empty-state">No announcements to view</p>
                      <% } %>
                </section>
                <section class="events-panel invitations-panel">
                  <h2>Invitations</h2>
                  <% if (hasInvitations) { %>
                    <table class="events-table">
                      <thead>
                        <tr>
                          <th>Event</th>
                          <th>Location</th>
                          <th>Start</th>
                          <th>End</th>
                          <th>Capacity</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% _invitations.forEach(function(i){ %>
                          <tr>
                            <td>
                              <%= i.event_title %>
                            </td>
                            <td>
                              <%= i.location %>
                            </td>
                            <td>
                              <%= new Date(i.start_time).toLocaleString() %>
                            </td>
                            <td>
                              <%= new Date(i.end_time).toLocaleString() %>
                            </td>
                            <td>
                              <%= (typeof i.capacity==='number' ) ? i.capacity : '—' %>
                            </td>
                            </td>
                          </tr>
                          <% }) %>
                      </tbody>
                    </table>
                    <% } else { %>
                      <p class="empty-state">No pending invitations</p>
                      <% } %>
                </section>

                <% } else if (_panel==='rsvpd' ) { %>
                  <section class="events-panel">
                    <h2>RSVP’d Events</h2>
                    <% if (hasRsvpd) { %>
                      <table class="events-table">
                        <thead>
                          <tr>
                            <th>Event</th>
                            <th>Location</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>RSVP Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% _rsvpd.forEach(function(r){ %>
                            <tr>
                              <td>
                                <%= r.event_title %>
                              </td>
                              <td>
                                <%= r.location %>
                              </td>
                              <td>
                                <%= new Date(r.start_time).toLocaleString() %>
                              </td>
                              <td>
                                <%= new Date(r.end_time).toLocaleString() %>
                              </td>
                              <td>
                                <%= r.rsvp_status %>
                              </td>
                            </tr>
                            <% }) %>
                        </tbody>
                      </table>
                      <% } else { %>
                        <p class="empty-state">No RSVPs to view</p>
                        <% } %>
                  </section>
                  <% } %>
      </div>

      <!-- Light grey content boxes -->
      <img class="dashboard-light-grey-1" src="dashboard-light-grey-box.svg" alt="" aria-hidden="true" />
      <img class="dashboard-light-grey-2" src="dashboard-light-grey-box.svg" alt="" aria-hidden="true" />
      <img class="dashboard-light-grey-3" src="dashboard-light-grey-box.svg" alt="" aria-hidden="true" />
      <img class="dashboard-light-grey-4" src="dashboard-light-grey-box.svg" alt="" aria-hidden="true" />

      <!-- Stats header overlay -->
      <img class="stats-header" src="stats-header.svg" alt="" aria-hidden="true" />
      <div class="stat stat--upcoming">
        <%= stats.upcoming %>
      </div>
      <div class="stat stat--attended">
        <%= stats.attended %>
      </div>
      <div class="stat stat--notifications">
        <%= stats.notifications %>
      </div>

      <!-- Sidebar text items -->
      <div class="brand">
        <img class="brand-logo" src="logo.svg" alt="EventScape logo" />
        <span class="brand-text">EventScape</span>
      </div>
      <h2 class="greeting">Hi, <%= displayName %>
      </h2>
      <div class="sidebar-actions">
        <a class="pill pill-grey" href="/events">
          <span>Event Dashboard</span>
        </a>

        <a class="pill pill-grey" href="/rsvpd">
          <span>RSVP’d Events</span>
        </a>

        <a class="pill pill-grey" href="/your-events">
          <span>Your Events</span>
        </a>

        <a class="pill pill-grey" href="/inbox">
          <span>Inbox</span>
        </a>

        <a class="pill pill-grey" href="/profile">
          <span>Profile Settings</span>
        </a>

        <a class="pill pill-grey" href="/logout">
          <span>Log out</span>
        </a>
      </div>
    </div>
    <script>
      window.addEventListener("load", function () {
        const greeting = document.querySelector(".greeting");
        if (!greeting) return;

        const maxWidth = 255;
        let fontSize = 20;
        while (greeting.scrollWidth > maxWidth && fontSize > 10) {
          fontSize -= 0.5;
          greeting.style.fontSize = fontSize + "px";
        }
        greeting.style.width = maxWidth + "px";
        greeting.style.textAlign = "center";
      });
    </script>
</body>

</html>